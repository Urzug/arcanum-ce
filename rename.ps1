param(
  [string]$SearchDir = ".",
  [switch]$DryRun
)

Write-Host "Starting FULL batch rename operation across: $SearchDir"
Write-Host "Targeting ALL .c and .h files recursively..."
Write-Host "--------------------------------------------------------"

# --- Mapping old -> new ---
$RenameMap = @{
"sub_4E1490" = "wall_editor_update"
"sub_4E1C00" = "wall_draw_rects_top_down"
"sub_4E1EB0" = "wall_draw_grid_overlay_top_down"
"sub_4E20A0" = "wall_delete_piece_group_A"
"sub_4E25B0" = "wall_delete_piece_group_B"
"sub_4E2C50" = "wall_update_adjacent_on_delete"
"sub_439890" = "roof_hit_test_screen_xy"
"sub_439FF0" = "roof_is_tile_covered_world_xy"
"sub_43A030" = "roof_is_tile_covered"
"sub_4395C0" = "roof_grid_index_from_tile_id"
"sub_43A140" = "roof_get_art_screen_rect"
"sub_438530" = "wallcheck_notify_player_moved"
"sub_502FD0" = "tig_art_is_pixel_transparent"
"sub_438570" = "wallcheck_add_or_update_wall"
"sub_4386B0" = "wallcheck_find_wall_in_list"
"sub_438720" = "wallcheck_roof_ref_add"
"sub_4387C0" = "wallcheck_find_roof_in_list"
"sub_438830" = "wallcheck_apply_changes"
"sub_404480" = "ai_get_ai_packet_field"
"sub_4044F0" = "ai_get_ai_packet_flag"
"sub_404550" = "ai_get_ai_packet_secondary_flag"
"sub_4045B0" = "ai_set_ai_packet_flag"
"sub_404E20" = "ai_set_target"
"sub_404E80" = "ai_find_target_in_list"
"sub_4057A0" = "ai_should_flee"
"sub_405820" = "ai_is_pc_or_follower"
"sub_405860" = "ai_is_berserk"
"sub_4068D0" = "ai_consider_target"
"sub_406930" = "ai_find_best_target"
"sub_406AE0" = "ai_can_see_obj"
"sub_404280" = "ai_find_new_target"
"sub_404390" = "ai_execute_strategy"
"sub_404610" = "ai_process_list"
"sub_404C70" = "ai_aggro_add"
"sub_404F70" = "ai_find_target_in_sorted_list_bsearch"
"sub_405020" = "ai_flee"
"sub_4058A0" = "ai_update_obj"
"sub_405AC0" = "ai_strategy_wander"
"sub_405D20" = "ai_strategy_wander_flee"
"sub_406210" = "ai_strategy_flee_from_object"
"sub_4064F0" = "ai_strategy_berserk"
"sub_406730" = "ai_strategy_stand_still"
"sub_423300" = "anim_get_current_id"
"sub_4233D0" = "anim_get_priority_level"
"sub_423470" = "anim_is_running"
"sub_4234F0" = "anim_is_combat_anim"
"sub_423E60" = "anim_set_debug_error_msg"
"sub_423FE0" = "anim_set_completion_callback"
"sub_423FF0" = "anim_clear_goals"
"sub_424070" = "anim_set_priority_level"
"sub_4243E0" = "anim_play_eye_candy_on_obj"
"sub_424560" = "anim_play_eye_candy_on_obj_ex"
"sub_4261E0" = "anim_path_get_dist"
"sub_426250" = "anim_path_get_rot_to"
"sub_426560" = "anim_path_find"
"sub_427000" = "anim_path_is_clear"
"sub_430460" = "anim_draw_all_overlays"
"sub_430490" = "anim_draw_obj_overlay"
"sub_432D90" = "anim_process_obj_goals"
"sub_433640" = "anim_is_obj_convinced_to_move"
"sub_433A00" = "anim_goal_move_to"
"sub_433C80" = "anim_goal_run_to"
"sub_434030" = "anim_goal_move_to_combat"
"sub_4341C0" = "anim_goal_move_near_loc"
"sub_434400" = "anim_goal_move_near_loc_combat"
"sub_4348E0" = "anim_deduct_action_points"
"sub_435A00" = "anim_goal_projectile_fire"
"sub_435CE0" = "anim_goal_is_projectile"
"sub_4364D0" = "anim_goal_death"
"sub_436C20" = "anim_goals_push_state"
"sub_436C50" = "anim_goals_set_current"
"sub_436C80" = "anim_goals_pop_state"
"sub_436CF0" = "anim_goals_clear_current"
"sub_436D20" = "anim_set_flags"
"sub_436ED0" = "anim_run"
"sub_4372B0" = "anim_can_move"
"sub_437980" = "anim_init_run_info_params"
"sub_437CF0" = "anim_run_info_param_set"
"stru_5E8AD0" = "g_multiplayer_player_slots"
"stru_5B3FF0" = "g_multiplayer_save_modules"
"dword_5F0E1C" = "g_multiplayer_object_lock_list"
"stru_5E8940" = "g_multiplayer_async_callbacks"
"dword_5F0DEC" = "g_multiplayer_save_obj_list"
"qword_5E8D78" = "g_multiplayer_trade_partners"
"qword_5F0E20" = "g_multiplayer_hidden_items"
"dword_5B4070" = "g_multiplayer_timeevent_filter_player_idx"
"dword_5B40D8" = "g_multiplayer_player_find_iterator"
"byte_5E8838" = "g_multiplayer_module_path_stripped"
"byte_5F0BEC" = "g_multiplayer_module_path_guid"
"off_5F0BC8" = "g_multiplayer_char_data_slots"
"stru_5F0D98" = "g_multiplayer_current_module_guid"
"dword_5F0DE0" = "g_multiplayer_join_request_count"
"dword_5F0DE4" = "g_multiplayer_pregen_char_handles"
"dword_5F0DE8" = "g_multiplayer_pregen_char_count"
"dword_5F0DF4" = "g_multiplayer_level_scheme_next_idx"
"dword_5F0DFC" = "g_multiplayer_message_queue_head"
"dword_5F0E00" = "g_multiplayer_session_active"
"off_5F0E04" = "g_multiplayer_game_update_override"
"dword_5F0E10" = "g_multiplayer_reset_lock_count"
"dword_5F0E14" = "g_multiplayer_disconnect_pending"
"dword_5F0E18" = "g_multiplayer_async_callback_next_idx"
"dword_5B3FD8" = "g_multiplayer_current_difficulty"
"dword_5B3FEC" = "g_multiplayer_disconnect_button_handle"
"multiplayer_mes_file" = "g_multiplayer_mes_file"
"multiplayer_lock_cnt" = "g_multiplayer_lock_count"
"dword_5F0E08" = "g_multiplayer_client_joined_callback"
"dword_5F0DF8" = "g_multiplayer_disconnect_callback"
"S5F0DEC" = "MultiplayerObjectNode"
"S5E8AD0" = "MultiplayerPlayerSlot"
"S5F0DFC" = "MultiplayerMessageNode"
"S5F0E1C" = "MultiplayerObjectLock"
"S5F0BC8" = "MultiplayerCharDataHeader"
"S5E8940" = "MultiplayerAsyncCallback"
"Func5F0E08" = "MultiplayerClientJoinedCallback"
"Func5F0DF8" = "MultiplayerDisconnectCallback"
"sub_49CB80" = "multiplayer_player_slot_init"
"sub_49CC50" = "multiplayer_start_server"
"sub_49CC70" = "multiplayer_load_module_and_start"
"sub_4A38B0" = "multiplayer_disconnect"
"sub_4A39D0" = "multiplayer_set_disconnect_callback"
"sub_4A5610" = "multiplayer_apply_settings"
"sub_4A1F60" = "multiplayer_get_player_obj"
"sub_4A2AE0" = "multiplayer_reset_player_slot"
"sub_4A2B60" = "multiplayer_get_player_obj_by_slot"
"sub_4A3D00" = "multiplayer_clear_pregen_char_list"
"sub_4A3D70" = "multiplayer_load_pregen_chars"
"sub_4A40D0" = "multiplayer_has_char_data"
"sub_4A40F0" = "multiplayer_set_char_data"
"sub_4A4180" = "multiplayer_get_char_data_ptr"
"sub_4A41B0" = "multiplayer_get_char_data_size"
"sub_4A41E0" = "multiplayer_get_char_data_oid"
"sub_4A4230" = "multiplayer_get_char_data_header"
"sub_4A4240" = "multiplayer_get_char_data_total_size"
"sub_4A4320" = "multiplayer_save_local_char"
"sub_4A6010" = "multiplayer_reset_critter_state"
"sub_4A6470" = "multiplayer_save_char_with_prompt"
"sub_4A6560" = "multiplayer_strip_guid_from_filename"
"sub_49D570" = "multiplayer_timeevent_is_xfer"
"sub_4A2040" = "multiplayer_send_loading_state"
"sub_4A2A30" = "multiplayer_update_game_state"
"sub_4A2B00" = "multiplayer_set_client_joined_callback"
"sub_4A2CD0" = "multiplayer_queue_message"
"sub_4A2D00" = "multiplayer_process_message_queue"
"sub_4A33F0" = "multiplayer_send_map_data_to_player"
"sub_4A3660" = "multiplayer_send_player_files"
"sub_4A3780" = "multiplayer_send_local_player_files_to_host"
"sub_4A54A0" = "multiplayer_anim_ping_handler"
"sub_4A54E0" = "multiplayer_magictech_ping_handler"
"sub_4A2E90" = "multiplayer_clear_object_locks"
"sub_4A2EC0" = "multiplayer_acquire_object_lock"
"sub_4A3030" = "multiplayer_add_object_lock"
"sub_4A3080" = "multiplayer_find_object_lock"
"sub_4A30D0" = "multiplayer_release_object_lock"
"sub_4A3170" = "multiplayer_remove_object_lock"
"sub_4A3230" = "multiplayer_request_object_lock"
"sub_4A50D0" = "multiplayer_hide_item"
"sub_4A51C0" = "multiplayer_show_item"
"sub_4A5290" = "multiplayer_init_hidden_items"
"sub_4A52C0" = "multiplayer_add_hidden_item"
"sub_4A5320" = "multiplayer_remove_hidden_item"
"sub_4A5380" = "multiplayer_init_trade_list"
"sub_4A53B0" = "multiplayer_set_active_trade_partner"
"sub_4A5460" = "multiplayer_get_trade_partner_count"
"sub_4A5670" = "multiplayer_auto_equip_char"
"sub_4A5710" = "multiplayer_auto_equip_give_money"
"sub_4A57F0" = "multiplayer_auto_equip_give_background_items"
"sub_4A5840" = "multiplayer_auto_equip_give_skill_items"
"sub_4A5920" = "multiplayer_auto_equip_give_items_from_mes"
"sub_4A59F0" = "multiplayer_auto_equip_give_weapon_items"
"sub_4A5CA0" = "multiplayer_auto_equip_give_armor"
"sub_4A5D80" = "multiplayer_auto_equip_check_has_items"
"sub_4A5E10" = "multiplayer_auto_equip_give_items_from_string"
"sub_4A5EE0" = "multiplayer_auto_equip_give_schematic_items"
"sub_4A1F30" = "multiplayer_teleport_obj"
"sub_4A3890" = "multiplayer_nop"
"sub_4A38A0" = "multiplayer_get_join_request_count"
"sub_4A4270" = "multiplayer_inc_lock_reset"
"sub_4A4280" = "multiplayer_dec_lock_reset"
"sub_4A55F0" = "multiplayer_get_difficulty"
"sub_4A5600" = "multiplayer_set_difficulty"
"sub_4A6190" = "multiplayer_is_pvp_damage_disallowed"
"sub_5022B0" = "tig_art_set_palette_adjust_callback"
"sub_5022C0" = "tig_art_get_palette_adjust_callback"
"sub_5022D0" = "tig_art_cache_invalidate_palettes"
"sub_502830" = "tig_art_item_id_get_max_num"
"sub_502E00" = "tig_art_palette_exists"
"sub_502E50" = "tig_art_frame_get_pixel_color"
"sub_503340" = "tig_art_frame_get_raw_pixels"
"sub_5033E0" = "tig_art_anim_get_frames_for_distance"
"sub_503700" = "tig_art_tile_id_get_edge_data"
"sub_503740" = "tig_art_tile_id_set_edge_data"
"sub_5037B0" = "tig_art_tile_id_get_variation_data"
"sub_503800" = "tig_art_tile_id_set_variation_data"
"sub_503F50" = "tig_art_anim_get_property"
"sub_503F60" = "tig_art_critter_get_size_class"
"sub_504390" = "tig_art_interface_id_get_flag"
"sub_504700" = "tig_art_light_id_rotation_get"
"sub_504730" = "tig_art_light_id_rotation_set"
"sub_504790" = "tig_art_light_id_get_rotation_mode_flag"
"sub_505000" = "tig_art_apply_palette_adjustment"
"sub_505940" = "art_blit_flags_to_video_blit_flags"
"sub_5059F0" = "art_blit_software"
"sub_51AA90" = "tig_art_cache_get_or_load_entry"
"sub_51B650" = "tig_art_cache_entry_free_video_buffers"
"sub_51B710" = "tig_art_file_load"
"sub_51BE30" = "art_header_get_num_rotations"
"sub_51BE50" = "tig_art_file_load_cleanup"
"sub_51BF20" = "art_header_free_frame_data"
"dword_5BE880" = "tig_art_tile_edge_map_1"
"dword_5BE8C0" = "tig_art_tile_edge_map_2"
"dword_5BE900" = "tig_art_anim_properties"
"dword_5BE980" = "tig_art_critter_body_type_properties"
"dword_5BE994" = "tig_art_monster_specie_properties"
"dword_5BEA18" = "tig_art_wall_rotation_map_1"
"dword_5BEA28" = "tig_art_wall_rotation_map_2"
"dword_604714" = "tig_art_cache_last_index"
"dword_604718" = "tig_art_use_3d_textures"
"dword_604744" = "tig_art_palette_adjust_callback"
"dword_604754" = "tig_art_check_stretch_blit_divide_by_zero"
"sub_4E6540" = "objid_create_a"
"sub_4E67A0" = "objid_parse_guid_str"
"sub_4E6970" = "objid_parse_p_str"
"sub_4E6A60" = "objid_parse_a_str"
"sub_4E6AA0" = "parse_hex_str_len"
"sub_4E6B00" = "validate_and_copy_hex_str_len"
"sub_4E4FD0" = "objp_perm_lookup_set"
"sub_4E5280" = "objp_perm_get_oid"
"sub_4E52F0" = "objp_perm_lookup_remove"
"sub_4E5300" = "objp_perm_lookup_compact"
"sub_4E57E0" = "objp_perm_lookup_find_index"
"dword_6036B8" = "objp_perm_lookup_table"
"dword_6036C0" = "objp_perm_lookup_capacity"
"dword_6036DC" = "objp_perm_lookup_size"
"sub_4B2210" = "combat_context_init"
"sub_4B2650" = "combat_projectile_hit_callback"
"sub_4B2690" = "combat_projectile_finish"
"sub_4B2870" = "combat_projectile_update"
"sub_4B2F60" = "combat_process_projectile_hit"
"sub_4B3170" = "combat_attack_resolve"
"sub_4B3BB0" = "combat_attack"
"sub_4B4320" = "combat_fidget_check"
"sub_4B5520" = "combat_multiplayer_is_damage_handled"
"sub_4B6C90" = "combat_set_turn_based_mode"
"sub_4B7010" = "combat_tb_process_npc_turn"
"sub_4B7080" = "combat_tb_queue_next_subturn"
"sub_4B7580" = "combat_tb_should_skip_critter"
"sub_4B7DC0" = "combat_tb_critter_is_hidden_and_active"
"sub_4B8040" = "combat_tb_npc_should_fidget"
"sub_4440E0" = "follower_info_init"
"sub_444110" = "follower_info_find"
"sub_444130" = "follower_info_validate"
"sub_43C690" = "object_draw_hover_overlay"
"sub_43CF70" = "object_remove_from_sector"
"sub_43D940" = "object_is_static_type"
"sub_43D9F0" = "object_find_by_screen_coords"
"sub_43E770" = "object_move"
"sub_43F030" = "object_invalidate_render_flags"
"sub_43F710" = "object_scenery_update_animation"
"sub_443770" = "object_clear_render_data"
"sub_4437E0" = "object_get_hover_rect_total"
"sub_443880" = "object_get_hover_art_rect"
"sub_443EB0" = "object_save_ref_init"
"sub_443F80" = "object_save_ref_find"
"sub_444020" = "object_save_ref_validate"
"sub_4445A0" = "object_move_to_actor"
"sub_43C5C0" = "object_draw_hover_underlay"
"sub_43CEA0" = "object_editor_delete"
"sub_43D690" = "object_get_hp_from_points"
"sub_43D630" = "object_get_hp_from_stats"
"sub_43FE00" = "object_check_los_recursive"
"sub_43FDC0" = "object_check_los"
"sub_43FD70" = "object_is_los_blocked"
"sub_442050" = "object_serialize_to_memory"
"sub_4420D0" = "object_deserialize_from_memory"
"sub_442260" = "object_insert_into_world"
"sub_4423E0" = "object_set_offset_internal"
"sub_442520" = "object_update_render_state"
"sub_442D90" = "object_apply_render_colors"
"sub_443620" = "object_get_eye_candy_rect"
"sub_4437C0" = "object_shadow_clear"
"sub_43AAA0" = "object_editor_is_culling_enabled"
"sub_43AAB0" = "object_editor_toggle_culling"
"sub_43F130" = "object_set_palette"
"sub_440700" = "object_is_portal_blocked"
"sub_441FC0" = "object_notify_npc_seen"
"sub_441540" = "object_get_party_size"
"dword_5A548C" = "g_eye_candy_scale_table"
"dword_5E2E70" = "g_object_dirty_rect_list"
"dword_5E2EC8" = "g_object_render_skip_flags"
"dword_5E2F28" = "g_object_editor_culling_enabled"
"dword_5E2F98" = "g_object_list_ref_count"
"dword_5E2E68" = "g_object_hover_overlay_art_slot"
"dword_5E2E6C" = "g_object_hover_underlay_art_slot"
"dword_5E2F48" = "g_video_is_3d_accelerated"
"stru_5E2F60" = "g_object_hover_save_ref"
"dword_5E2E94" = "g_object_hover_is_critter"
"qword_5E2E60" = "g_object_vis_range_y"
"qword_5E2F50" = "g_object_vis_range_x"
"sub_4E5AA0" = "field_metadata_acquire"
"sub_4E5B40" = "field_metadata_release"
"sub_4E5BF0" = "field_metadata_clone"
"sub_4E5C60" = "field_metadata_set_or_clear_bit"
"sub_4E5CE0" = "field_metadata_test_bit"
"sub_4E5D30" = "field_metadata_count_set_bits_up_to"
"sub_4E5DB0" = "field_metadata_iterate_set_bits"
"sub_4E5E20" = "field_metadata_serialize_to_tig_file"
"sub_4E5E80" = "field_metadata_deserialize_from_tig_file"
"sub_4E5F10" = "field_metadata_calculate_export_size"
"sub_4E5F30" = "field_metadata_export_to_memory"
"sub_4E5F70" = "field_metadata_import_from_memory"
"sub_4E4C50" = "memory_read_from_cursor"
"sub_4EB0C0" = "GetTileNameByType"
"sub_4EC4B0" = "InitializePortalNames"
"sub_4EC8F0" = "GetPortalNameFromArtID"
"sub_4EC940" = "GetWallArtIDFromFilename"
"sub_4ECB80" = "ParseWallProtoEntry"
"sub_4ECC00" = "GetWallProtoDamageArtId"
"dword_687680" = "g_tileCategoryBufferSizes"
"dword_603AF8" = "g_tileEdgeData"
"sub_4EB860" = "CheckTileConnectivitySetup"
"sub_4EB770" = "ParseTileEdgeName"
"sub_4EB7D0" = "FindTileIndexByName"
"sub_4EB8D0" = "FindPathBetweenTiles"
"sub_4D9240" = "GetTileHeight"
"sub_426320" = "CalculateMaxPathRotations"
"sub_4A8570" = "AICheckActionPreconditions"
"sub_460C20" = "GetUIActiveObject"
"sub_4AA620" = "AIInitiateFollow"
"sub_4AABE0" = "AISetOrUpdateDangerSource"
"sub_4A9AD0" = "InitiateCombat"
"dword_5F848C" = "g_onCombatInitiationCallback"
"sub_4A9F10" = "AINotifyNearbyNPCsOfEvent"
"sub_4ADE00" = "FindLineOfSightBlocker"
"sub_4AF640" = "CalculateHearingObstructionPenalty"
"dword_5B50C0" = "g_loudnessDistanceTable"
"sub_4AB990" = "AIIsValidShitlistTarget"
"sub_4C1110" = "GetPCWithHighestReaction"
"sub_4C0CE0" = "GetReactionScore"
"sub_4C1290" = "CalculateReactionModifier"
"sub_4C12F0" = "GetReactionLevelForPC"
"sub_4C1360" = "SetReactionLevelForPC"
"sub_42A490" = "AnimGoalUsePicklockSkill"
"sub_4246D0" = "AnimGoalMoveToPause"
"sub_42A440" = "AnimGoalUsePickpocketSkill"
"sub_42B090" = "AnimGoalGenericSelfObj"
"sub_421CE0" = "IsAnimIDMatchForRunInfo"
"sub_422430" = "SaveAnimationGoalParameter"
"sub_422A50" = "LoadAnimationGoalParameter"
"dword_5A597C" = "g_animGoalParamTypes"
"sub_423D10" = "UpdateAnimationGoal"
"sub_425760" = "IsValidAnimationMoveTarget"
"sub_42ACD0" = "AnimGoalCheckTarget"
"sub_437990" = "GetAnimationRate"
"sub_42EF60" = "CheckDirectionalCondition"
"sub_42F000" = "UpdateProjectileAnimation"
"sub_437C50" = "GetPathCoordsAtIndex"
"sub_44E2C0" = "InterruptAnimation"
"sub_4CCD20" = "GetAnimFXNodeByID"
"sub_4CD7A0" = "AddAnimFX"
"sub_44D520" = "StartAnimationGoal"
"sub_44D4E0" = "AnimGoalDataInit"
"sub_44E8C0" = "IsObjectAnimating"
"dword_5B770C" = "g_animFXScaleValues"
"off_5B0530" = "g_animGoalDataParamNames"
"sub_44C840" = "AnimRunSetGoalNode"
"sub_44E6F0" = "AnimGoalAddWithArgs"
"sub_44E940" = "FindAnimationByGoalType"
"sub_44EB40" = "IsPathingToObject"
"sub_44EBD0" = "AnimPathReset"
"sub_44EBE0" = "AnimPathClear"
"sub_44EBF0" = "AnimRunInfoAdvanceGoal"
"sub_4AE720" = "CanCastSpellOrUseTech"
"sub_4503A0" = "IsTechnologicalSchematic"
"sub_450B40" = "ItemHasCharges"
"sub_459040" = "GetObjectSummonerIfSpellFlag"
"sub_455960" = "MagicTechRunInfoFree"
"sub_45BAF0" = "TimeEventAdd"
"sub_45DC90" = "AdjustAlignmentOnKill"
"sub_4574D0" = "ProcessItemUseCompletion"
"sub_461620" = "CalculateMagicTechEffectivenessModifier"
"sub_461F60" = "IsItemWorthless"
"sub_463E20" = "SpawnInventory"
"sub_4EFAE0" = "SetInventorySpawnedFlag"
"sub_4685A0" = "GetProtoHandleFromID"
"sub_4640C0" = "RefreshInventoryForNearbyPlayers"
"sub_4642C0" = "IsItemInInventory"
"sub_464C50" = "WieldItemToFirstAvailableSlot"
"sub_464D20" = "CheckCanWieldItem"
"sub_466A50" = "AddKeyToKeyring"
"sub_467E70" = "GetItemForceRemoveStatus"
"sub_4F2CB0" = "TargetFindAtScreenCoords"
"sub_4F2D10" = "TargetGetHoverTarget"
"sub_4F2D20" = "ValidateTargetEligibility"
"sub_4F4E40" = "FindLocationNearObject"
"sub_41F3C0" = "PathCreate"
"sub_41F840" = "PathfindDirect"
"sub_41F9F0" = "PathfindAStar"
"sub_420330" = "PathBresenhamLineProcessor"
"sub_420660" = "PathCreateProjectile"
"dword_5DE5F8" = "g_pathfinding_timer_start"
"dword_5DE5FC" = "g_pathfinding_op_count"
"dword_5DE600" = "g_pathfinding_time_limit_ms"
"sub_41AFB0" = "SoundSchemeInit"
"sub_41BAF0" = "UpdateAmbientSound"
"sub_41BCD0" = "ResolveSoundPath"
"sub_41BD10" = "FindActiveSoundScheme"
"sub_41BF70" = "ParseAndAddSoundToScheme"
"dword_5D1A30" = "g_preCombatMusicSchemes"
"sub_40DAB0" = "PlayerDestroyLocalPC"
"sub_40DAF0" = "PlayerSetLocalPC"
"sub_40FED0" = "UIEnterTurnBasedMode"
"sub_412F60" = "DialogFileFreeEntries"
"sub_414F50" = "FindPCReplyOptions"
"sub_417590" = "ParseDialogResponseValue"
"sub_41D390" = "GetMissingArtCount"
"sub_44BC60" = "ScriptFindInitBlock"
"sub_45B300" = "TimeEventIsProcessingAllowed"
"sub_45B320" = "TimeEventPause"
"sub_45B340" = "TimeEventResume"
"sub_45B360" = "TimeEventResetPause"
"sub_45A7F0" = "GetCurrentGameTimeMs"
"sub_45A950" = "DateTimeAddMilliseconds"
"sub_44E2A0" = "IsGlobalTimeEvent"
"sub_4B9130" = "ScreenRectToLocationRect"
"sub_4D0090" = "GetSectorDataForLocationRect"
"dword_5B0CBC" = "g_magictech_test_obj_field_map"
"dword_5B32A0" = "g_ammo_type_to_obj_field_map"
"dword_5B32B0" = "g_ammo_type_to_proto_map"
"dword_5B772C" = "g_scale_index_map"
"in_reset" = "g_is_in_reset"
"in_load" = "g_is_loading_game"
"dword_5D10C4" = "g_module_guid_is_set"
"dword_5DE640..5DE668" = "g_anim_state_counters"
"dword_5DE69C..5DE6B0" = "g_anim_state_flags"
"qword_5FC248..5FC270" = "g_combat_turn_state_vars"
"dword_60170C" = "g_animfx_list_registry"
"stru_601700" = "g_animfx_current_anim_id"
"dword_601734" = "g_animfx_mes_handle"
"stru_5B0DF8" = "g_summon_type_table_wild"
"dword_5FC630" = "g_inven_source_initialized"
}  # <-- important: hashtable CLOSED here

# Build a fast combined regex:  \b(?:key1|key2|...)\b
$escapedKeys = $RenameMap.Keys | ForEach-Object { [Regex]::Escape($_) }
$pattern = '\b(?:' + ($escapedKeys -join '|') + ')\b'
$regex = [System.Text.RegularExpressions.Regex]::new($pattern)

# Files
$files = Get-ChildItem -Recurse -Include *.c, *.h -Path $SearchDir -File
$changedCount = 0

foreach ($f in $files) {
    $text = Get-Content -LiteralPath $f.FullName -Raw
    $newText = $regex.Replace($text, { param($m) $RenameMap[$m.Value] })
    if ($newText -ne $text) {
        Write-Host "Updated: $($f.FullName)"
        if (-not $DryRun) {
            Set-Content -LiteralPath $f.FullName -Value $newText -NoNewline -Encoding UTF8
        }
        $changedCount++
    }
}

Write-Host "--------------------------------------------------------"
if ($DryRun) {
    Write-Host "Dry run complete. Files that would change: $changedCount"
} else {
    Write-Host "Batch rename complete. Files changed: $changedCount"
}
Read-Host "Press Enter to exit..."